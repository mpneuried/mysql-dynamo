<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>mysql-dynamo by mpneuried</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/main.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>

      <header>
        <h1>mysql-dynamo</h1>
        <p>A solution to use the simple-dynamo interface with a MySQL database. So you can create a offline version of a AWS-DynamoDB project.</p>
      </header>

      <div id="banner">
        <span id="logo"></span>

        <a href="https://github.com/mpneuried/mysql-dynamo" class="button fork"><strong>View On GitHub</strong></a>
        <div class="downloads">
          <span>Downloads:</span>
          <ul>
            <li><a href="https://github.com/mpneuried/mysql-dynamo/zipball/master" class="button">ZIP</a></li>
            <li><a href="https://github.com/mpneuried/mysql-dynamo/tarball/master" class="button">TAR</a></li>
          </ul>
        </div>
      </div><!-- end banner -->

    <div class="wrapper">
      <nav>
        <ul></ul>
      </nav>
      <section>
        <h1>
<a name="mysql-dynamo" class="anchor" href="#mysql-dynamo"><span class="octicon octicon-link"></span></a>mysql-dynamo</h1>

<p><a href="http://travis-ci.org/mpneuried/mysql-dynamo"><img src="https://secure.travis-ci.org/mpneuried/mysql-dynamo.png?branch=master" alt="Build Status"></a></p>

<p>A solution to use the <strong><a href="http://mpneuried.github.io/simple-dynamo/">simple-dynamo</a></strong> interface with a MySQL database. So you can create a offline version of a AWS-DynamoDB project.</p>

<p><em>Written in coffee-script</em></p>

<p><strong>INFO: all examples are written in coffee-script</strong></p>

<h1>
<a name="install" class="anchor" href="#install"><span class="octicon octicon-link"></span></a>Install</h1>

<pre><code>  npm install mysql-dynamo
</code></pre>

<h1>
<a name="connection-and-table" class="anchor" href="#connection-and-table"><span class="octicon octicon-link"></span></a>Connection and Table</h1>

<h2>
<a name="api-differences-to-simple-dynamo" class="anchor" href="#api-differences-to-simple-dynamo"><span class="octicon octicon-link"></span></a>API differences to <code>simple-dynamo</code>
</h2>

<p>Compared to the <code>simple-dynamo</code> module you only have to make a few smears.</p>

<ul>
<li>
<strong>Table-Config</strong> <code>consistent</code> not existes and will be ignored</li>
<li>
<strong>Table-Config</strong> <code>overwriteExistingHash</code> not exists. It always will NOT overwrite existing hashes</li>
<li>
<strong>Table-Config</strong> <code>combineTableTo</code> not exists. Within MySQL there is no need to save tables</li>
<li>
<strong>Table-Attribute-Config</strong> <code>length</code> The length of a field has to be defined</li>
<li>
<strong>Table-Attribute-Config</strong> <code>default</code> The SQL default of a field could be defined</li>
<li>
<strong>Item-Method-Options</strong> <code>consistent</code> not existes and will be ignored</li>
<li>
<strong>Item-Method-Options</strong> <code>overwriteExistingHash</code> not exists. It always will NOT overwrite existing hashes</li>
</ul><p><strong>One big difference between the Dynamo and MySQL version is that dynamo can generate undefined attributes on the fly. Th MySQL version will ignore undefined attributes. So all necessary attributes has to be defined within the table definitions</strong></p>

<h2>
<a name="initialize" class="anchor" href="#initialize"><span class="octicon octicon-link"></span></a>Initialize</h2>

<p>first you have to define the connection and table attributes and get an instance of the simple-dynamo interface.</p>

<p><code>new MySqlDynamo( connectionSettings, tables )</code></p>

<h3>
<a name="connection-settings" class="anchor" href="#connection-settings"><span class="octicon octicon-link"></span></a>connection Settings</h3>

<hr><ul>
<li>
<strong>tablePrefix</strong> : <em>( <code>String</code> optional )</em> Option to prefix all generating tables</li>
</ul><p><strong>MySQL connection settings</strong> </p>

<ul>
<li>
<strong>host</strong> : <em>( <code>String</code> required )</em> MySQL host</li>
<li>
<strong>user</strong> : <em>( <code>String</code> optional: default = <code>root</code> )</em> MySQL user</li>
<li>
<strong>password</strong> : <em>( <code>String</code> optional: default = <code>secret</code> )</em> MySQL password</li>
<li>
<strong>database</strong> : <em>( <code>String</code> optional: default = <code>database</code> )</em> Database name</li>
</ul><h3>
<a name="table-definition" class="anchor" href="#table-definition"><span class="octicon octicon-link"></span></a>table Definition</h3>

<p>An Object of Tables.<br>
The key you are using will be the key to get the table object.</p>

<p>Every object can have the following keys:</p>

<ul>
<li>
<strong>name</strong> : <em>( <code>String</code> required )</em><br>
Tablename for MySQL</li>
<li>
<strong>hashKey</strong> : <em>( <code>String</code> required )</em><br>
The hash key name of your ids/hashes</li>
<li>
<strong>hashKeyType</strong> : <em>( <code>String</code> optional: default = <code>S</code> )</em><br>
The type of the <code>hashKey</code>. Possible values are: <code>S</code> = String and <code>N</code> = Numeric</li>
<li>
<strong>hashKeyLength</strong> : <em>( <code>Number</code> optional: default = <code>5</code> for hashKeyType <code>N</code> and <code>255</code> for hashKeyType <code>S</code> )</em><br>
The table field length</li>
<li>
<strong>rangeKey</strong>: <em>( String optional )</em><br>
The range key name of your range attribute. If not defined the table will be generated without the range methods</li>
<li>
<strong>rangeKeyType</strong>: <em>( <code>String</code> optional: default = <code>N</code> )</em><br>
The type of the <code>rangeKey</code>. Possible values are: <code>S</code> = String and <code>N</code> = Numeric</li>
<li>
<strong>rangeKeyLength</strong> : <em>( <code>Number</code> optional: default = <code>5</code> for rangeKeyType <code>N</code> and <code>255</code> for rangeKeyType <code>S</code> )</em><br>
The table field length</li>
<li>
<strong>fnCreateHash</strong>: <em>( <code>Function</code> optional: default = <code>new UUID</code> )</em><br>
Method to generate a custom hash key.<br>
</li>
<li>
<strong>defaultfields</strong>: <em>( <code>Array</code> optional )</em><br>
List of fields to return as default. If nothing is defined all fields will be received. You always can overwrite this using <code>options.fields</code>.<br><strong>Method Arguments</strong><br><ul>
<li>
<strong>attributes</strong>: The given attributes on create<br>
</li>
<li>
<strong>cb</strong>: Callback method to pass the custom generates id/hash. <code>cb( "my-special-hash" )</code>
</li>
</ul>
</li>
<li>
<strong>fnCreateRange</strong>: <em>( <code>Function</code> optional: default = <code>current Timestamp</code> )</em><br>
Method to generate a custom range key.<br><strong>Method Arguments</strong><br><ul>
<li>
<strong>attributes</strong>: The given attributes on create<br>
</li>
<li>
<strong>cb</strong>: Callback method to pass the custom generates id/hash. <code>cb( "my-special-range" )</code>
</li>
</ul>
</li>
<li>
<p><strong>attributes</strong>: <em>( <code>Array of Objects</code> required )</em><br>
An array of attribute Objects. Which will be validated<br><strong>Attributes keys</strong></p>

<ul>
<li>
<strong>key</strong>: <em>( <code>String</code> required )</em><br>
Column/Attribute name/key</li>
<li>
<strong>type</strong>: <em>( <code>String</code> required )</em><br>
Datatype. possible values are <code>string</code> = String, <code>number</code> = Numeric and <code>array</code> = Array/Set of <strong>Strings</strong>
</li>
<li>
<strong>required</strong>: <em>( <code>Boolean</code> optional: default = <code>false</code> )</em><br>
Validate the attribute to be required. <em>( Not implemented yet ! )</em>
</li>
<li>
<strong>length</strong>: <em>( <code>Number</code> optional: default = <code>255</code> )</em><br>
Lentgh of the MySQL DB Filed. If you combine <code>type</code> = <code>string</code> with a <code>length</code>= <code>+Infinity</code> the field will generated as type <code>TEXT</code> otherwise as <code>VARCHAR( length )</code>. If you define a <code>number</code> with a length &gt; 11 a type <code>BIGINT( length )</code> will be used. On a length &lt;= 11 a type <code>INT( length )</code> will be generated.</li>
<li>
<strong>default</strong> <em>( <code>String</code> optional: default = `` )</em><br>
The SQL default value</li>
</ul>
<p><strong>Example</strong></p>
</li>
</ul><div class="highlight"><pre><span class="c1"># import module</span>
<span class="nv">MySQLDynamo = </span><span class="nx">require</span> <span class="s">"mysql-dynamo"</span>

<span class="c1"># define connection settings</span>
<span class="nv">connectionSettings =</span>
    <span class="nv">host: </span><span class="s">"localhost"</span>
    <span class="nv">user: </span><span class="s">"root"</span>
    <span class="nv">password: </span><span class="s">"root"</span>
    <span class="nv">database: </span><span class="s">"myDB"</span>

<span class="c1"># define tables</span>
<span class="nv">tables = </span>
    <span class="s">"Users"</span><span class="o">:</span>
        <span class="nv">name: </span><span class="s">"users"</span>
        <span class="nv">hashKey: </span><span class="s">"id"</span>

        <span class="nv">attributes: </span><span class="p">[</span>
            <span class="p">{</span> <span class="nv">key: </span><span class="s">"name"</span><span class="p">,</span> <span class="nv">type: </span><span class="s">"string"</span><span class="p">,</span> <span class="nv">required: </span><span class="kc">true</span> <span class="p">}</span>
            <span class="p">{</span> <span class="nv">key: </span><span class="s">"email"</span><span class="p">,</span> <span class="nv">type: </span><span class="s">"string"</span> <span class="p">}</span>
        <span class="p">]</span>

    <span class="s">"Todos"</span><span class="o">:</span>
        <span class="nv">name: </span><span class="s">"todos"</span>
        <span class="nv">hashKey: </span><span class="s">"id"</span>
        <span class="nv">rangeKey: </span><span class="s">"_t"</span>
        <span class="nv">rangeKeyType: </span><span class="s">"N"</span>

        <span class="nv">fnCreateHash: </span><span class="nf">( attributes, cb )=&gt;</span>
            <span class="nx">cb</span><span class="p">(</span> <span class="nx">attributes</span><span class="p">.</span><span class="nx">user_id</span> <span class="p">)</span>
            <span class="k">return</span>

        <span class="nv">attributes: </span><span class="p">[</span>
            <span class="p">{</span> <span class="nv">key: </span><span class="s">"title"</span><span class="p">,</span> <span class="nv">type: </span><span class="s">"string"</span><span class="p">,</span> <span class="nv">required: </span><span class="kc">true</span> <span class="p">}</span>
            <span class="p">{</span> <span class="nv">key: </span><span class="s">"done"</span><span class="p">,</span> <span class="nv">type: </span><span class="s">"number"</span> <span class="p">}</span>
        <span class="p">]</span>

<span class="c1"># create instance</span>
<span class="nv">sqldManager = </span><span class="k">new</span> <span class="nx">MySQLDynamo</span><span class="p">(</span> <span class="nx">connectionSettings</span><span class="p">,</span> <span class="nx">tables</span> <span class="p">)</span>

<span class="c1"># connect</span>
<span class="nx">sqldManager</span><span class="p">.</span><span class="nx">connect</span> <span class="nf">( err )-&gt;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="s">"mysql-dynamo ready to use"</span> <span class="p">)</span>
</pre></div>

<h2>
<a name="first-connect-to-mysql" class="anchor" href="#first-connect-to-mysql"><span class="octicon octicon-link"></span></a>First connect to MySQL</h2>

<p>The module has to know about the existing SQL tables so you have to read them first.<br><strong>If you do not run <code>.connect()</code> the module will throw an error everytime</strong> </p>

<p><strong><code>Manager.connect( fnCallback )</code> Arguments</strong> : </p>

<ul>
<li>
<strong>fnCallback</strong>: <em>( <code>Function</code> required )</em><br>
Callback method. Single arguments on return is the error object. On success the error is <code>null</code>
</li>
</ul><p><strong>Example</strong></p>

<div class="highlight"><pre><span class="nx">sqldManager</span><span class="p">.</span><span class="nx">connect</span> <span class="nf">( err )-&gt;</span>
    <span class="k">if</span> <span class="nx">err</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span> <span class="s">"connect ERROR"</span><span class="p">,</span> <span class="nx">err</span> <span class="p">)</span>
    <span class="k">else</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="s">"mysql-dynamo ready to use"</span> <span class="p">)</span>
</pre></div>

<h2>
<a name="create-all-tables" class="anchor" href="#create-all-tables"><span class="octicon octicon-link"></span></a>Create all tables</h2>

<p>to create all missing tables just call <code>.createAll()</code>.</p>

<p>This is not necessary if you know the tables has been created in the past.</p>

<p><strong><code>Manager.generateAll( fnCallback )</code> Arguments</strong> : </p>

<ul>
<li>
<strong>fnCallback</strong>: <em>( <code>Function</code> required )</em><br>
Callback method. Single arguments on return is the error object. On success the error is <code>null</code>
</li>
</ul><p><strong>Example</strong></p>

<div class="highlight"><pre><span class="nx">sqldManager</span><span class="p">.</span><span class="nx">generateAll</span> <span class="nf">( err )-&gt;</span>
    <span class="k">if</span> <span class="nx">err</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span> <span class="s">"connect ERROR"</span><span class="p">,</span> <span class="nx">err</span> <span class="p">)</span>
    <span class="k">else</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="s">"mysql-dynamo ready to use"</span> <span class="p">)</span>
</pre></div>

<h2>
<a name="get-a-table-instance" class="anchor" href="#get-a-table-instance"><span class="octicon octicon-link"></span></a>Get a table instance</h2>

<p>To interact with a table you have to retrieve the table object. It's defined in the table-definitions</p>

<p><strong><code>Manager.get( 'tableName' )</code> Arguments</strong> : </p>

<ul>
<li>
<strong>tableName</strong>: <em>( <code>String</code> required )</em><br>
Method to retrieve the instance of a table object.</li>
</ul><p><strong>Example</strong></p>

<div class="highlight"><pre><span class="nv">tblTodos = </span><span class="nx">sqldManager</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span> <span class="s">'Todos'</span> <span class="p">)</span>
</pre></div>

<h2>
<a name="loop-through-all-tables" class="anchor" href="#loop-through-all-tables"><span class="octicon octicon-link"></span></a>Loop through all tables</h2>

<p>Loop trough all table objects</p>

<p><strong><code>Manager.each( eachFn )</code> Arguments</strong> : </p>

<ul>
<li>
<strong>eachFn</strong>: <em>( <code>Function</code> required )</em><br>
Loop method call for every table object</li>
</ul><p><strong>Example</strong></p>

<div class="highlight"><pre><span class="nx">Manager</span><span class="p">.</span><span class="nx">each</span> <span class="nf">( tableKey, tableObj )=&gt;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="s">"SQL table name"</span><span class="p">,</span> <span class="nx">tableObj</span><span class="p">.</span><span class="nx">tableName</span> <span class="p">)</span>
    <span class="k">return</span>
</pre></div>

<h2>
<a name="destroy-a-table" class="anchor" href="#destroy-a-table"><span class="octicon octicon-link"></span></a>Destroy a table</h2>

<p>destroy table in MySQL. This drops a table from MySQL will all the data</p>

<p><strong><code>Table.destroy( fnCallback )</code> Arguments</strong> : </p>

<ul>
<li>
<strong>fnCallback</strong>: <em>( <code>Function</code> required )</em><br>
Callback method.<br><strong>Method Arguments</strong><br><ul>
<li>
<strong>err</strong>: Usually <code>null</code>. On an error a object with <code>error</code> and <code>msg</code>
</li>
</ul>
</li>
</ul><p><strong>Example</strong></p>

<div class="highlight"><pre><span class="nx">tblTodos</span><span class="p">.</span><span class="nx">del</span> <span class="nf">( err )-&gt;</span>
    <span class="k">if</span> <span class="nx">err</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span> <span class="s">"destroy ERROR"</span><span class="p">,</span> <span class="nx">err</span> <span class="p">)</span>
    <span class="k">else</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="s">"table destroyed"</span> <span class="p">)</span>
</pre></div>

<h1>
<a name="item-handling" class="anchor" href="#item-handling"><span class="octicon octicon-link"></span></a>Item handling</h1>

<h2>
<a name="write-a-new-item-insert" class="anchor" href="#write-a-new-item-insert"><span class="octicon octicon-link"></span></a>Write a new item (INSERT)</h2>

<p>Create a new item in a select table. You can also add some attributes not defined in the table-definition, which will be saved, too.</p>

<p><strong><code>Table.set( data, options, fnCallback )</code> Arguments</strong> : </p>

<ul>
<li>
<strong>data</strong>: <em>( <code>Object</code> required )</em><br>
The data to save. You can define the hash and/or range key. If not the module will generate a hash/range automatically.<br><em>Note:</em> If the used table uses the combined feature and you define the hash-key it's necessary to add the <code>name</code> out of the table-config in front of every hash.</li>
<li>
<strong>options</strong>: <em>( <code>Object</code> optional )</em><br><ul>
<li>
<strong>fields</strong>: <em>( <code>Array</code> )</em> An array of fields to receive</li>
</ul>
</li>
<li>
<strong>fnCallback</strong>: <em>( <code>Function</code> required )</em><br>
Callback method.<br><strong>Method Arguments</strong><br><ul>
<li>
<strong>err</strong>: Usually <code>null</code>. On an error a object with <code>error</code> and <code>msg</code>
</li>
<li>
<strong>item</strong>: the save item as simple object</li>
</ul>
</li>
</ul><p><strong>Example</strong></p>

<div class="highlight"><pre><span class="nv">data = </span>
    <span class="nv">title: </span><span class="s">"My First Todo"</span>
    <span class="nv">done: </span><span class="mi">0</span>
    <span class="nv">aditionalData: </span><span class="s">"Foo bar"</span>

<span class="nx">tblTodos</span><span class="p">.</span><span class="nx">set</span> <span class="nx">data</span><span class="p">,</span> <span class="nf">( err, todo )-&gt;</span>
    <span class="k">if</span> <span class="nx">err</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span> <span class="s">"insert ERROR"</span><span class="p">,</span> <span class="nx">err</span> <span class="p">)</span>
    <span class="k">else</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">todo</span> <span class="p">)</span>
</pre></div>

<h2>
<a name="get-a-item-get" class="anchor" href="#get-a-item-get"><span class="octicon octicon-link"></span></a>Get a item (GET)</h2>

<p>Get an existing element by id/hash</p>

<p><strong><code>Table.get( id[, options], fnCallback )</code> Arguments</strong> : </p>

<ul>
<li>
<strong>id</strong>: <em>( <code>String|Number|Array</code> required )</em><br>
The id of an element. If the used table is a range table you have to use an array <code>[hash,range]</code> as combined id. Otherwise you will get an error. </li>
<li>
<strong>options</strong>: <em>( <code>Object</code> optional )</em><br><ul>
<li>
<strong>fields</strong>: <em>( <code>Array</code> )</em> An array of fields to receive. If nothing is defined all fields are returned.</li>
</ul>
</li>
<li>
<strong>fnCallback</strong>: <em>( <code>Function</code> required )</em><br>
Callback method.<br><strong>Method Arguments</strong><br><ul>
<li>
<strong>err</strong>: Usually <code>null</code>. On an error a object with <code>error</code> and <code>msg</code>
</li>
<li>
<strong>item</strong>: the database item as simple object. If not found <code>null</code>
</li>
</ul>
</li>
</ul><p><strong>Example</strong></p>

<div class="highlight"><pre><span class="nx">tblTodos</span><span class="p">.</span><span class="nx">get</span> <span class="s">'myTodoId'</span><span class="p">,</span> <span class="nf">( err, todo )-&gt;</span>
    <span class="k">if</span> <span class="nx">err</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span> <span class="s">"get ERROR"</span><span class="p">,</span> <span class="nx">err</span> <span class="p">)</span>
    <span class="k">else</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">todo</span> <span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span class="nx">tblRangeTodos</span><span class="p">.</span><span class="nx">get</span> <span class="p">[</span> <span class="s">'myHash'</span><span class="p">,</span> <span class="s">'myRange'</span> <span class="p">],</span> <span class="nf">( err, todo )-&gt;</span>
    <span class="k">if</span> <span class="nx">err</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span> <span class="s">"get ERROR"</span><span class="p">,</span> <span class="nx">err</span> <span class="p">)</span>
    <span class="k">else</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">todo</span> <span class="p">)</span>
</pre></div>

<h2>
<a name="get-many-items-mget" class="anchor" href="#get-many-items-mget"><span class="octicon octicon-link"></span></a>Get many items (MGET)</h2>

<p>Get an many existing elements by id/hash in one request</p>

<p><strong><code>Table.mget( [ id1, id2, .. ], options, fnCallback )</code> Arguments</strong> : </p>

<ul>
<li>
<strong>ids</strong>: <em>( <code>Array</code> required )</em><br>
An array of id of an elements. If the used table is a range table you have to use an array of arrays <code>[hash,range]</code> as combined id. Otherwise you will get an error. </li>
<li>
<strong>options</strong>: <em>( <code>Object</code> optional )</em><br><ul>
<li>
<strong>fields</strong>: <em>( <code>Array</code> )</em> An array of fields to receive. If nothing is defined all fields are returned.</li>
</ul>
</li>
<li>
<strong>fnCallback</strong>: <em>( <code>Function</code> required )</em><br>
Callback method.<br><strong>Method Arguments</strong><br><ul>
<li>
<strong>err</strong>: Usually <code>null</code>. On an error a object with <code>error</code> and <code>msg</code>
</li>
<li>
<strong>items</strong>: the database items as a array of simple objects. Only existing items will be received. </li>
</ul>
</li>
</ul><p><strong>Example</strong></p>

<div class="highlight"><pre><span class="nx">tblTodos</span><span class="p">.</span><span class="nx">mget</span> <span class="p">[</span> <span class="s">'myTodoIdA'</span><span class="p">,</span> <span class="s">'myTodoIdB'</span> <span class="p">],</span> <span class="nf">( err, todos )-&gt;</span>
    <span class="k">if</span> <span class="nx">err</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span> <span class="s">"get ERROR"</span><span class="p">,</span> <span class="nx">err</span> <span class="p">)</span>
    <span class="k">else</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">todos</span> <span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span class="nx">tblRangeTodos</span><span class="p">.</span><span class="nx">mget</span> <span class="p">[</span> <span class="p">[</span> <span class="s">'myHash'</span><span class="p">,</span> <span class="mi">1</span> <span class="p">],</span> <span class="p">[</span> <span class="s">'myHash'</span><span class="p">,</span> <span class="mi">2</span> <span class="p">]</span> <span class="p">],</span> <span class="nf">( err, todos )-&gt;</span>
    <span class="k">if</span> <span class="nx">err</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span> <span class="s">"get ERROR"</span><span class="p">,</span> <span class="nx">err</span> <span class="p">)</span>
    <span class="k">else</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">todos</span> <span class="p">)</span>
</pre></div>

<h2>
<a name="update-an-item-update" class="anchor" href="#update-an-item-update"><span class="octicon octicon-link"></span></a>Update an item (UPDATE)</h2>

<p>update an existing item.<br>
To remove a attribute you have to set the value to <code>null</code></p>

<p><strong><code>Table.set( id, data, options, fnCallback )</code> Arguments</strong> : </p>

<ul>
<li>
<strong>id</strong>: <em>( <code>String|Number|Array</code> required )</em><br>
The id of an element. If the used table is a range table you have to use an array <code>[hash,range]</code> as combined id. Otherwise you will get an error. </li>
<li>
<strong>data</strong>: <em>( <code>Object</code> required )</em><br>
The data to update. You can redefine the range key. If you pass the hash key it will be ignored</li>
<li>
<strong>options</strong>: <em>( <code>Object</code> optional )</em><br>
For update you can define some options.

<ul>
<li>
<strong>fields</strong>: <em>( <code>Array</code> )</em> An array of fields to receive</li>
<li>
<strong>conditionals</strong> <em>( <code>Object</code> )</em> A query object to define a conditional. Only <code>{"==": value}</code>, <code>{"==": null}</code>, and <code>{"!=": null}</code> are allowed. How to build? … have a look at <a href="https://github.com/jed/dynamo/wiki/High-level-API#wiki-predicates">Jed's Predicates </a>
</li>
</ul>
</li>
<li>
<strong>fnCallback</strong>: <em>( <code>Function</code> required )</em><br>
Callback method.<br><strong>Method Arguments</strong><br><ul>
<li>
<strong>err</strong>: Usually <code>null</code>. On an error a object with <code>error</code> and <code>msg</code>
</li>
<li>
<strong>item</strong>: the database item as simple object. If not found <code>null</code>
</li>
</ul>
</li>
</ul><p><strong>Example</strong></p>

<div class="highlight"><pre><span class="nv">data = </span>
    <span class="nv">title: </span><span class="s">"My First Update"</span>
    <span class="nv">done: </span><span class="mi">1</span>

<span class="nx">tblTodos</span><span class="p">.</span><span class="nx">set</span> <span class="s">'myTodoId'</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nf">( err, todo )-&gt;</span>
    <span class="k">if</span> <span class="nx">err</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span> <span class="s">"update ERROR"</span><span class="p">,</span> <span class="nx">err</span> <span class="p">)</span>
    <span class="k">else</span>
        <span class="c1"># note. the key 'aditionalData' will be gone</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">todo</span> <span class="p">)</span>
</pre></div>

<h2>
<a name="delete-an-item-delete" class="anchor" href="#delete-an-item-delete"><span class="octicon octicon-link"></span></a>Delete an item (DELETE)</h2>

<p>delete an item by id/hash</p>

<p><strong><code>Table.del( id, fnCallback )</code> Arguments</strong> : </p>

<ul>
<li>
<strong>id</strong>: <em>( <code>String|Number|Array</code> required )</em><br>
The id of an element. If the used table is a range table you have to use an array <code>[hash,range]</code> as combined id. Otherwise you will get an error. </li>
<li>
<strong>fnCallback</strong>: <em>( <code>Function</code> required )</em><br>
Callback method.<br><strong>Method Arguments</strong><br><ul>
<li>
<strong>err</strong>: Usually <code>null</code>. On an error a object with <code>error</code> and <code>msg</code>
</li>
</ul>
</li>
</ul><p><strong>Example</strong></p>

<div class="highlight"><pre><span class="nx">tblTodos</span><span class="p">.</span><span class="nx">del</span> <span class="s">'myTodoId'</span><span class="p">,</span> <span class="nf">( err )-&gt;</span>
    <span class="k">if</span> <span class="nx">err</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span> <span class="s">"delete ERROR"</span><span class="p">,</span> <span class="nx">err</span> <span class="p">)</span>
    <span class="k">else</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="s">"delete done"</span> <span class="p">)</span>
</pre></div>

<h2>
<a name="query-a-table-find" class="anchor" href="#query-a-table-find"><span class="octicon octicon-link"></span></a>Query a table (FIND)</h2>

<p>run a query on a table. The module automatically trys to do a <code>Dynamo.db scan</code> or <code>Dynamo query</code>.</p>

<p><strong><code>Table.find( query, startAt, options, fnCallback )</code> Arguments</strong> : </p>

<ul>
<li>
<strong>query</strong>: <em>( <code>Object</code> : default = <code>{}</code> all )</em><br>
A query object. How to build … have a look at <a href="https://github.com/jed/dynamo/wiki/High-level-API#wiki-predicates">Jed's Predicates </a>
</li>
<li>
<strong>startAt</strong>: <em>( <code>String|Number|Array</code> optional )</em><br>
To realize a paging you can define a <code>startAt</code>. Usually the last item of a list. If you define <code>startAt</code> with the last item of the previous find you get the next collection of items without the given <code>startAt</code> item.<br>
If the used table is a range table you have to use an array <code>[hash,range]</code> as combined <code>startAt</code>. Otherwise you will get an error. </li>
<li>
<strong>options</strong>: <em>( <code>Object</code> optional )</em><br><ul>
<li>
<strong>fields</strong>: <em>( <code>Array</code> )</em> An array of fields to receive</li>
<li>
<strong>limit</strong>: <em>( <code>Number</code> )</em> Define the max. items to return</li>
<li>
<strong>forward</strong>: <em>( <code>Boolean</code> default = true  )</em> define the direction <code>acs</code> or <code>desc</code> for range querys. </li>
</ul>
</li>
<li>
<strong>fnCallback</strong>: <em>( <code>Function</code> required )</em><br>
Callback method.<br><strong>Method Arguments</strong><br><ul>
<li>
<strong>err</strong>: Usually <code>null</code>. On an error a object with <code>error</code> and <code>msg</code>
</li>
<li>
<strong>items</strong>: an array of objects found</li>
</ul>
</li>
</ul><p><strong>Example</strong></p>

<div class="highlight"><pre><span class="nx">tblTodos</span><span class="p">.</span><span class="nx">find</span> <span class="p">{},</span> <span class="nf">( err, items )-&gt;</span>
    <span class="k">if</span> <span class="nx">err</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span> <span class="s">"delete ERROR"</span><span class="p">,</span> <span class="nx">err</span> <span class="p">)</span>
    <span class="k">else</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="s">"all existend items"</span><span class="p">,</span> <span class="nx">items</span> <span class="p">)</span>
</pre></div>

<p><strong>Advanced Examples</strong></p>

<div class="highlight"><pre><span class="c1"># create a query to read all todos from last hour</span>
<span class="nv">_query = </span>
    <span class="nv">id: </span><span class="p">{</span> <span class="s">"!="</span><span class="o">:</span> <span class="kc">null</span> <span class="p">}</span>
    <span class="nv">_t: </span><span class="p">{</span> <span class="s">"&lt;"</span><span class="o">:</span> <span class="p">(</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="p">(</span> <span class="mi">1000</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="p">)</span> <span class="p">)</span> <span class="p">}</span>

<span class="nx">tblTodos</span><span class="p">.</span><span class="nx">find</span> <span class="p">,</span> <span class="nf">( err, items )-&gt;</span>
    <span class="k">if</span> <span class="nx">err</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span> <span class="s">"delete ERROR"</span><span class="p">,</span> <span class="nx">err</span> <span class="p">)</span>
    <span class="k">else</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="s">"found items"</span><span class="p">,</span> <span class="nx">items</span> <span class="p">)</span>
</pre></div>

<div class="highlight"><pre><span class="c1"># read 4 todos from last hour beginning starting with a known id</span>
<span class="nv">_query = </span>
    <span class="nv">id: </span><span class="p">{</span> <span class="s">"!="</span><span class="o">:</span> <span class="kc">null</span> <span class="p">}</span>
    <span class="nv">_t: </span><span class="p">{</span> <span class="s">"&lt;"</span><span class="o">:</span> <span class="p">(</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="p">(</span> <span class="mi">1000</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="p">)</span> <span class="p">)</span> <span class="p">}</span>

<span class="nv">_startAt = </span><span class="s">"myid_todoItem12"</span>

<span class="nv">_options = </span><span class="p">{</span> <span class="s">"limit"</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s">"fields"</span><span class="o">:</span> <span class="p">[</span> <span class="s">"id"</span><span class="p">,</span> <span class="s">"_t"</span><span class="p">,</span> <span class="s">"title"</span> <span class="p">]</span> <span class="p">}</span>

<span class="nx">tblTodos</span><span class="p">.</span><span class="nx">find</span> <span class="nx">_query</span><span class="p">,</span> <span class="nx">_startAt</span><span class="p">,</span> <span class="nx">_options</span><span class="p">,</span> <span class="nf">( err, items )-&gt;</span>
    <span class="k">if</span> <span class="nx">err</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span> <span class="s">"delete ERROR"</span><span class="p">,</span> <span class="nx">err</span> <span class="p">)</span>
    <span class="k">else</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="s">"4 found items"</span><span class="p">,</span> <span class="nx">items</span> <span class="p">)</span>
</pre></div>

<h2>
<a name="working-with-sets" class="anchor" href="#working-with-sets"><span class="octicon octicon-link"></span></a>Working with sets</h2>

<p>Dynamo has the ability to work with sets. That means you can save a Set of Strings as an Array.<br>
During an update you have the ability to add or remove a single value out of the set. Or you can reset the whole set.  </p>

<p>But you can only perform one action per key and you only can use the functionality if defined through the table-definition ( <code>type:"array"</code> ).</p>

<p>Existing values will be ignored.</p>

<p>The following key variants are available:</p>

<ul>
<li>
<code>"key":[ "a", "b", "c" ]'</code>: Resets the whole value of the key</li>
<li>
<code>"key":{ "$add": [ "d", "e" ] }</code>: Add some values to the set</li>
<li>
<code>"key":{ "$rem": [ "a", "b" ] }</code>: remove some values</li>
<li>
<code>"key":{ "$reset": [ "x", "y" ] }</code>: reset the whole value. Same as <code>"key":[ "x", "y" ]'</code>
</li>
<li>
<code>"key":{ "$add": "d"}</code>: Add a single value to the set</li>
<li>
<code>"key":{ "$rem": "a" }</code>: remove a single value</li>
<li>
<code>"key":{ "$reset": "y" }</code>: reset the whole set to a single value. Same as <code>"key":[ "y" ]'</code>
</li>
</ul><p><strong>Examples</strong></p>

<div class="highlight"><pre><span class="c1"># Source "key: [ "a", "b", "c" ]"</span>

<span class="nv">data = </span>
    <span class="nv">key: </span><span class="p">[</span> <span class="s">"x"</span><span class="p">,</span> <span class="s">"y"</span><span class="p">,</span> <span class="s">"z"</span> <span class="p">]</span>

<span class="nx">tblSets</span><span class="p">.</span><span class="nx">set</span> <span class="s">'mySetsId'</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nf">( err, setData )-&gt;</span>
    <span class="c1"># Result "key: [ "x", "y", "z" ]"</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">setData</span> <span class="p">)</span>
</pre></div>

<pre><code># Source "key: [ "a", "b", "c" ]"

data = 
    key: { "$add": [ "a", "d", "e" ] }

tblSets.set 'mySetsId', data, ( err, setData )-&gt;
    # Result "key: [ "a", "b", "c", "d", "e" ]"
    console.log( setData )
</code></pre>

<pre><code># Source "key: [ "a", "b", "c" ]"

data = 
    key: { "$rem": [ "a", "b", "x" ] }

tblSets.set 'mySetsId', data, ( err, setData )-&gt;
    # Result "key: [ "c" ]"
    console.log( setData )
</code></pre>

<pre><code># Source "key: [ "a", "b", "c" ]"

data = 
    key: { "$reset": [ "x", "y", "z" ] }

tblSets.set 'mySetsId', data, ( err, setData )-&gt;
    # Result "key: [ "x", "y", "z" ]"
    console.log( setData )
</code></pre>

<h1>
<a name="events" class="anchor" href="#events"><span class="octicon octicon-link"></span></a>Events</h1>

<p>To provide a API to react on different events you can listen to a bunch of events.</p>

<h2>
<a name="manager-events" class="anchor" href="#manager-events"><span class="octicon octicon-link"></span></a>Manager Events</h2>

<ul>
<li>
<code>new-table</code>: Table object initialized and ready to use. This means only the client model is ready. Eventually you have to create the table first.<br><strong>Event Arguments</strong><br><ul>
<li>
<strong>name</strong>: the name og the table, like you would use with `Manager.get()</li>
<li>
<strong>Table</strong>: the <code>Table</code> object</li>
</ul>
</li>
<li>
<code>table-generated</code>: Fired after all a new tables has been generated.
<strong>Event Arguments</strong><br><ul>
<li>
<strong>Meta</strong>: the tables meta-data</li>
</ul>
</li>
<li>
<code>all-tables-generated</code>: Fired after all tables are generated.<br>
</li>
</ul><h2>
<a name="table-events" class="anchor" href="#table-events"><span class="octicon octicon-link"></span></a>Table Events</h2>

<ul>
<li>
<code>create-status</code>: fired on table create.<br><strong>Event Arguments</strong><br><ul>
<li>
<strong>status</strong>: describes the state of table creation. Possible values are: <code>already-active</code>, <code>waiting</code>, <code>active</code>
</li>
</ul>
</li>
<li>
<code>get</code>: fired after a table.get.<br><strong>Event Arguments</strong><br><ul>
<li>
<strong>item</strong>: the item</li>
</ul>
</li>
<li>
<code>get-empty</code>: fired after a table.get with an empty result.<br>
</li>
<li>
<code>mget</code>: fired after a table.mget.<br><strong>Event Arguments</strong><br><ul>
<li>
<strong>items</strong>: the items</li>
</ul>
</li>
<li>
<code>mget-empty</code>: fired after a table.mget with no results.<br>
</li>
<li>
<code>create</code>: fired after a item has been created.<br><strong>Event Arguments</strong><br><ul>
<li>
<strong>item</strong>: the created item</li>
</ul>
</li>
<li>
<code>update</code>: fired after a item has been updated.<br><strong>Event Arguments</strong><br><ul>
<li>
<strong>item_new</strong>: the item after the update</li>
</ul>
</li>
<li>
<code>delete</code>: fired after a item has been deleted.<br><strong>Event Arguments</strong><br><ul>
<li>
<strong>item_old</strong>: the item before the delete</li>
</ul>
</li>
</ul><h2>
<a name="changelogs" class="anchor" href="#changelogs"><span class="octicon octicon-link"></span></a>Changelogs</h2>

<h3>
<a name="021-7-june-2013" class="anchor" href="#021-7-june-2013"><span class="octicon octicon-link"></span></a>0.2.1 <code>7. June 2013</code>
</h3>

<ul>
<li>Added missing destroy table</li>
<li>Print a a warning on table destroy and table create</li>
</ul><h3>
<a name="020-7-june-2013" class="anchor" href="#020-7-june-2013"><span class="octicon octicon-link"></span></a>0.2.0 <code>7. June 2013</code>
</h3>

<ul>
<li>Added manager/table option <code>tablePrefix</code> to prefix the sql table names</li>
<li>added manager method <code>.each()</code>
</li>
<li>Changed tests to drop the tables before test</li>
</ul><h3>
<a name="014-6-june-2013" class="anchor" href="#014-6-june-2013"><span class="octicon octicon-link"></span></a>0.1.4 <code>6. June 2013</code>
</h3>

<ul>
<li>Print out a warning if attributes are removed by the validation</li>
</ul><h3>
<a name="013-6-june-2013" class="anchor" href="#013-6-june-2013"><span class="octicon octicon-link"></span></a>0.1.3 <code>6. June 2013</code>
</h3>

<ul>
<li>Fixed package json to use the correct <code>mysql-node</code> version if an older version is already used within the project</li>
</ul><h3>
<a name="012-6-june-2013" class="anchor" href="#012-6-june-2013"><span class="octicon octicon-link"></span></a>0.1.2 <code>6. June 2013</code>
</h3>

<ul>
<li>Added code docs with docker</li>
<li>Some small code improvements</li>
</ul><h3>
<a name="011-6-june-2013" class="anchor" href="#011-6-june-2013"><span class="octicon octicon-link"></span></a>0.1.1 <code>6. June 2013</code>
</h3>

<ul>
<li>Added Readme</li>
</ul><h3>
<a name="010-5-june-2013" class="anchor" href="#010-5-june-2013"><span class="octicon octicon-link"></span></a>0.1.0 <code>5. June 2013</code>
</h3>

<ul>
<li>Initial version</li>
</ul><h2>
<a name="todos" class="anchor" href="#todos"><span class="octicon octicon-link"></span></a>Todos</h2>

<ul>
<li>better validation of the given config-data</li>
</ul><h3>
<a name="work-in-progress" class="anchor" href="#work-in-progress"><span class="octicon octicon-link"></span></a>Work in progress</h3>

<p><code>mysql-dynamo</code> is work in progress. Your ideas, suggestions etc. are very welcome.</p>

<h2>
<a name="license" class="anchor" href="#license"><span class="octicon octicon-link"></span></a>License</h2>

<p>(The MIT License)</p>

<p>Copyright (c) 2010 TCS &lt;dev (at) tcs.de&gt;</p>

<p>Permission is hereby granted, free of charge, to any person obtaining
a copy of this software and associated documentation files (the
'Software'), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:</p>

<p>The above copyright notice and this permission notice shall be
included in all copies or substantial portions of the Software.</p>

<p>THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>
      </section>
      <footer>
        <p>Project maintained by <a href="https://github.com/mpneuried">mpneuried</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="http://twitter.com/#!/michigangraham">mattgraham</a></small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-32491479-4");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>